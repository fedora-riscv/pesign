From 2ced112a031c65791f04d46ce73f6d64a17ad069 Mon Sep 17 00:00:00 2001
From: Peter Jones <pjones@redhat.com>
Date: Fri, 20 Nov 2015 19:19:49 -0500
Subject: [PATCH 1/2] Don't setfacl when the socket or dir aren't there.

Signed-off-by: Peter Jones <pjones@redhat.com>
---
 src/pesign-authorize-groups | 8 ++++++--
 src/pesign-authorize-users  | 8 ++++++--
 2 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/src/pesign-authorize-groups b/src/pesign-authorize-groups
index e3864ce..2222809 100644
--- a/src/pesign-authorize-groups
+++ b/src/pesign-authorize-groups
@@ -11,7 +11,11 @@
 
 if [[ -r /etc/pesign/groups ]]; then
     for group in $(cat /etc/pesign/groups); do
-        setfacl -m g:${group}:rx /var/run/pesign
-        setfacl -m g:${group}:rw /var/run/pesign/socket
+	if [ -d /var/run/pesign ]; then
+	    setfacl -m g:${group}:rx /var/run/pesign
+	    if [ -e /var/run/pesign/socket ]; then
+		setfacl -m g:${group}:rw /var/run/pesign/socket
+	    fi
+	fi
     done
 fi
diff --git a/src/pesign-authorize-users b/src/pesign-authorize-users
index e500204..22bddec 100644
--- a/src/pesign-authorize-users
+++ b/src/pesign-authorize-users
@@ -11,7 +11,11 @@
 
 if [[ -r /etc/pesign/users ]]; then
     for username in $(cat /etc/pesign/users); do
-        setfacl -m u:${username}:rx /var/run/pesign
-        setfacl -m u:${username}:rw /var/run/pesign/socket
+	if [ -d /var/run/pesign ]; then
+	    setfacl -m g:${username}:rx /var/run/pesign
+	    if [ -e /var/run/pesign/socket ]; then
+		setfacl -m g:${username}:rw /var/run/pesign/socket
+	    fi
+	fi
     done
 fi
-- 
2.5.0

