From c2f2c8845b3ed34da0a76806ec81bc5ad60179ef Mon Sep 17 00:00:00 2001
From: Peter Jones <pjones@redhat.com>
Date: Mon, 12 Mar 2018 10:51:24 -0400
Subject: [PATCH] Use sql-type nss database everywhere by default.

Signed-off-by: Peter Jones <pjones@redhat.com>
---
 src/authvar.c    | 2 ++
 src/client.c     | 3 +++
 src/efikeygen.c  | 2 ++
 src/efisiglist.c | 2 ++
 src/pesigcheck.c | 2 ++
 src/pesign.c     | 2 ++
 6 files changed, 13 insertions(+)

diff --git a/src/authvar.c b/src/authvar.c
index 03e0c47f61c..47a73d12eaa 100644
--- a/src/authvar.c
+++ b/src/authvar.c
@@ -272,6 +272,8 @@ main(int argc, char *argv[])
 
 	int action = 0;
 
+	setenv("NSS_DEFAULT_DB_TYPE", "sql", 0);
+
 	rc = authvar_context_init(ctxp);
 	if (rc < 0) {
 		fprintf(stderr, "Could not initialize context: %m\n");
diff --git a/src/client.c b/src/client.c
index 575c873fb70..64e7bbb7689 100644
--- a/src/client.c
+++ b/src/client.c
@@ -22,6 +22,7 @@
 #include <popt.h>
 #include <pwd.h>
 #include <stddef.h>
+#include <stdlib.h>
 #include <sys/socket.h>
 #include <sys/stat.h>
 #include <sys/types.h>
@@ -628,6 +629,8 @@ main(int argc, char *argv[])
 		POPT_TABLEEND
 	};
 
+	setenv("NSS_DEFAULT_DB_TYPE", "sql", 0);
+
 	optCon = poptGetContext("pesign", argc, (const char **)argv, options,0);
 
 	rc = poptReadDefaultConfig(optCon, 0);
diff --git a/src/efikeygen.c b/src/efikeygen.c
index 93905782c0c..ad34970a62d 100644
--- a/src/efikeygen.c
+++ b/src/efikeygen.c
@@ -595,6 +595,8 @@ int main(int argc, char *argv[])
 		POPT_TABLEEND
 	};
 
+	setenv("NSS_DEFAULT_DB_TYPE", "sql", 0);
+
 	optCon = poptGetContext("pesign", argc, (const char **)argv, options,0);
 
 	int rc = poptReadDefaultConfig(optCon, 0);
diff --git a/src/efisiglist.c b/src/efisiglist.c
index a7ed528ca13..b88c4a06ded 100644
--- a/src/efisiglist.c
+++ b/src/efisiglist.c
@@ -177,6 +177,8 @@ main(int argc, char *argv[])
 		POPT_TABLEEND
 	};
 
+	setenv("NSS_DEFAULT_DB_TYPE", "sql", 0);
+
 	optCon = poptGetContext("pesign", argc, (const char **)argv, options,0);
 
 	rc = poptReadDefaultConfig(optCon, 0);
diff --git a/src/pesigcheck.c b/src/pesigcheck.c
index c8e10860855..535999ca7fa 100644
--- a/src/pesigcheck.c
+++ b/src/pesigcheck.c
@@ -464,6 +464,8 @@ main(int argc, char *argv[])
 		POPT_TABLEEND
 	};
 
+	setenv("NSS_DEFAULT_DB_TYPE", "sql", 0);
+
 	rc = pesigcheck_context_init(ctxp);
 	if (rc < 0) {
 		fprintf(stderr, "pesigcheck: Could not initialize context: %m\n");
diff --git a/src/pesign.c b/src/pesign.c
index 6ceda34f797..bc12e4d920a 100644
--- a/src/pesign.c
+++ b/src/pesign.c
@@ -416,6 +416,8 @@ main(int argc, char *argv[])
 	char *certdir = "/etc/pki/pesign";
 	char *signum = NULL;
 
+	setenv("NSS_DEFAULT_DB_TYPE", "sql", 0);
+
 	rc = pesign_context_new(&ctxp);
 	if (rc < 0) {
 		fprintf(stderr, "Could not initialize context: %m\n");
-- 
2.26.2

